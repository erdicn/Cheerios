\documentclass[a4paper, 11pt, oneside]{article} % A4 paper size, default 11pt font size and oneside for equal margins

\usepackage[utf8]{inputenc} % Required for inputting international characters
\usepackage[T1]{fontenc} % Output font encoding for international characters
\usepackage[french]{babel}
\usepackage{csquotes}

\usepackage[twoside, margin=2cm, bindingoffset=0.0cm]{geometry}

\usepackage{hyperref} %For hyperlinks 
\hypersetup{pdfborder=0 0 0}

\usepackage{graphicx}  % Pour images
\graphicspath{{Figures/}}
\usepackage{float}
\usepackage{wrapfig}
\usepackage{xcolor}

\usepackage{tikzit} % Pour les Tikz
\usepackage{tikzscale}
\input{Figures/sample.tikzstyles}
\usetikzlibrary{calc,patterns,angles,quotes}


\usepackage[%backend=biber,
style = ieee,
sorting=none
]{biblatex} %,bibstyle=ieeehttps://www.overleaf.com/project/624dc5f129c1767e8bb8de67
\addbibresource{biblio.bib}
\renewbibmacro*{date}{%
  \iffieldundef{year}
    {\bibstring{nodate}}
    {\printdate}
}

\newcommand{\comment}[1]{}%pour faire des comentaires a plusueures lignes 
\newcommand{\dd}[1]{\mathrm{d}#1}
% TODO trouver une meilleure alternative que ca car ca enleve litalique et apres faire renewcommand \vb*{\}\(
    
\usepackage{physics} %pour \vb*{b}old vectors
%\newcommand{\vb*}[1]{\boldsymbol{#1}}
%\newcommand{\vb*}[][]{}
\begin{document} 
\usetikzlibrary{patterns,patterns.meta}
\tableofcontents
\listoffigures
\listoftables

\newpage
\section*{Introduction}
    \input{Introduction.tex}

\section{Le problème et notre modélisation}
    \input{Problèmes_Modélisation.tex}

\section{Méthodes numériques et algorithme}
    \subsection{Integration de Verlet}
        Pour déterminer nos coordonnées, vitesses et accélérations en fonction du temps nous avons opté pour l'intégration de Verlet. L'intégration de Verlet est un algorithme simple à mettre en place et qui permet de conserver l'énergie dans le système. L'algorithme utilise le développement limité de Taylor de notre vecteur position à l'ordre 3.

        %On prouve lintegration de verlet et montre que on peux lutiliser pour notre probleme
        %Si on applique le developement limite de x on peux deduir les positions suivant
        Démonstration du développement limité de Taylor Young de $f(x)$ au point $x_0$\cite{agarwal_introduction_2011} :% TODO citer le livre de introduction a lanalyse complexe et numerique dans la mir 
        \begin{equation}
            \mathrm{DL}_n f(x) = \sum_{i=0}^{n}\frac{f^{(i)}(x_0)}{i!}(x-x_0)^i+ o((x-x_0)^n)
        \end{equation}
        Si on applique le développement limité d'ordre 3 à la position($\vb*{x}(t+\dd t)$) au point $t+\dd t$ on a l'équation suivante avec $t_0$ comme le pas de temps précédent :
        % On a ca avec le developement limilte a $t$ et $t_0$ cest le pas temps precedent
        \begin{equation}
            \Rightarrow\mathrm{DL}_3 \vb*{x}(t) = \vb*{x}(t_0)+\vb*{x}^{'}(t_0)(t-t_0)+\frac{\vb*{x}^{''}(t_0)}{2!}(t-t_0)^2 +o((t-t_0)^3)
        \end{equation}
        Si $t_0$ est le pas de temps précédent, $\vb*{x}^{'}(t)$ vitesse et $\vb*{x}^{''}(t)$ l'accélération, nous avons :
        \begin{equation}
            \Rightarrow\mathrm{DL}_3 \vb*{x}(t+\dd t) = \vb*{x}(t)+\vb*{x}^{'}(t)(t+\dd t-t)+\frac{\vb*{x}^{''}(t)}{2!}(t+\dd t-t)^2+o(t+\dd t-t)
        \end{equation}
        \begin{equation}
            \Rightarrow \mathrm{DL}_3 \vb*{x}(t+\dd t)= \vb*{x}(t)+\vb*{v}(t)(\dd t)+\frac{\vb*{a}(t)}{2!}(\dd t)^2+o(\dd t^3)
        \end{equation}
        L'erreur sur le temps $t_n$ est de l'ordre de $o(\exp(Lt_n)\dd t^2)$ % TODO pas sur de ici

        Notre accélération ne dépendant pas du changement de vitesse mais de l'équation (\ref{eq:ForceInteraction}), nous pouvons calculer l'accélération à partir du principe fondamental de la dynamique avec une masse constante. Il est important de faire cela après le calcul de position mais avant la vitesse car la position prend l'accélération précédente et la vitesse prend celui de avant et pendant le temps.
        \begin{equation}
            \label{PFD}
            \sum  \vb*{F} = m\vb*{a} \Longrightarrow \vb*{a} = \frac{\sum \vb*{F}}{m}
        \end{equation}

        Maintenant nous avons la nouvelle position et l'accélération, nous pouvons calculer la nouvelle vitesse de la même façon en utilisant le développement limité de Taylor Young à l'ordre 2 car après l'accélération nous ne connaissons pas le \textit{jerk} (changement de l'accélération par rapport au temps).
        \begin{equation}
            \mathrm{DL}_2\vb*{v}(t) = \vb*{v}(t_0) + \vb*{v}^{'}(t_0)(t-t_0) + o((t-t_0)^2)
        \end{equation}
        %Si $t_0$ cest le pas de temps precedent ($t_0 = $) et $\vb'{v}(t)$ l'acceleration, nous avons:
        De la meme façon que on a fait notre position ($\vb*{x}(t+dt)$) nous pouvons l'appliquer a la vitesse aussi, nous avons:
        \begin{equation}
            \mathrm{DL}_2\vb*{v}(t+\dd t) = \vb*{v}(t) + \vb*{a}(t)(\dd t) + o(\dd t^2)
        \end{equation}

        % TODO jai limpression que la formule de bas viens de qqpart mais je sais pas de ou ? peut etre une meilleur approwximation ???????
        Comme nous connaissons l'accélération au pas de temps suivant et precedent en meme temps on peux avoir une meilleur approximation de notre vitesse en utilisant le théorème des accroissements fini. TODO ICI JE SUIS PAS DU TOUT SUR ????
        \begin{equation}
            \label{eq:verletVitesse}
            \vb*{v}(t+\dd t) = \vb*{v}(t)+\frac{\vb*{a}(t)+\vb*{a}(t+\dd t)}{2}\dd t 
        \end{equation}
        % est que on mets ca sur lanexe ?
        % (voir lanexe pour le developement du calcul) 
        %        \[DL_3 x(t+\dd t)= x(t)+x^{'}(t)(\dd t)+\frac{x^{''}(t)}{2!}(\dd t)^2\]
        %= & x(t)+x^{'}(t)(t+\dd t-t)+\frac{x^{''}(t)}{2!}(t+\dd t-t)^2\\
        %Essai avec $x(t)$\[DL x(t) = x(t_0)+x^{'}(t_0)(t-t_0)+\frac{x^{''}(t_0)(t-t_0)^2}{2!}\]
    \subsection{Collisions}
        \subsubsection{Collisions Objet-Objet}
            %Ce que Baptiste a fait 
            Pour les collisions, nous sommes partis sur un modèle assez simple qui itère chaque objet et regarde si la distance entre leurs centres est plus petite que leurs rayons additionnés. Si c'est le cas, nous disons qu'il y a collision entre eux et nous appliquons la collision avec la conservation du momentum. 
            % TODO peut etre metre une partie de cela dans la subsection conclusions ? 
            Nous avons mis en place les collisions entre deux objets mais également entre un objet et les bords. Le fonctionnement des collisions entre ces deux cas est très différent. Pour les collisions entre objets, nous prenons dans un premier temps le vecteur normé de collision, dans le sens de objet 1(A) vers objet 2(B):
            % TODO peut etre preciser que cest pour le calcul de A et pour B il faux le refaire ? ou pas jsp ???
            \begin{equation}
                \vb*{c} = \frac{\vb*{AB}}{||\vb*{AB}||} \longrightarrow ||\vb*{c}|| = 1
            \end{equation}
            Puis nous calculons la vitesse relative $\vb*{v}_{rel} = \vb*{v}_A - \vb*{v}_B$ pour comprendre comment les 2 objets vont s'affecter. Après cela, nous trouvons la vitesse des objets lors de la collision afin de nous être utile pour déterminer l'impulsion qui suivra la collision :
            % TODO peut etre preciser que la vitesse de collision nest pas un vecteur ?
            \begin{equation}
                v_{col}=\vb*{v_{rel}}\cdot\vb*{c}
            \end{equation}
            Nous ajoutons à cette vitesse un coefficient compris entre 0.2 et 0.7 car nous n'avons pas de collisions élastiques parfaites. Il faut cependant faire attention à cette constante; Si elle est trop basse, les objets n'auront pas le rebond nécessaire et vont commencer à s'entrer dedans. Si elle est trop haute, les objets vont, à l'inverse, beaucoup rebondir. Toutefois, plus notre pas de temps est petit, plus ces effets vont disparaître.
            
            % TODO pas sur de ici faut tester (note pour moi dans le futur)
            Le signe de la vitesse de collision nous donne si les objets viens vers eux($v_{col} > 0$) ou se elloigne($v_{col} < 0$) car cest possible que quand on a fait la collision pour un objet que on a bien modifie lautre objet aussi donc parfoit on a besoin de faire ca une seule foir et parfois entre temps en faisant tout les collisions il peux revenir. % La phrase na pas de sens jsp ???
            
            % TODO peut etre faire un schema pour montrer les vecteurs que on parle ?
            Si la vitesse de collision est plus grande que 0; on fais la conservation de momentum.
            
            Impulse ($I$)
            \begin{equation}
                I = \frac{2v_{col}}{m_A + m_B}
            \end{equation}
            \begin{equation}
                \vb*{v}_A^{'} = \vb*{v}_A - Im_B\vb*{c}
            \end{equation}
            \begin{equation}
                \vb*{v}_B^{'} = \vb*{v}_B + Im_A\vb*{c}
            \end{equation}
            %Ce que Erdi a fait
            % Expliquer comment on a deduit que les collisions etait des collisions inelastic parfait et metre les equations utilise
            % Pour les collisions, nous sommes partis sur un modèle assez simple qui itère chaque objet et regarde si la distance entre eux est plus petite que leur rayons additionnés on dis que il ya une collision et on applique les collisions et la conservation de momentum.
            

        \newpage
        \subsubsection{Collision des bords}
            \begin{wrapfigure}{r}{0.25\textwidth}
                \centering
                \includegraphics[width = 0.15\textwidth]{rebond.tikz}
                \caption{Schéma d'un rebond d'un objet sur un bord}
            \end{wrapfigure}
            Et aussi on fait des collisions de bord aussi.
            Pour les collisions de bord on a fait tel que si notre objet dépassait le bord de tres peut on inverse le vecteur vitesse par rapport a la normale. Et apres multiplie ce vecteur par un coefficient de collision ($C_c$), $0 \leq C_c \leq 1$ qui simule l'absorbions de l'énergie a chaque collisions. 
            % TODO la fiqure ici cest broullion objective de montrer la norme tangent et la vitesse
            \begin{equation}
                \vb*{v}^{'} = (\vb*{v}\cdot\vb*{n})\vb*{n} +(\vb*{v}\cdot\vb*{t})\vb*{t}
            \end{equation}
            On inverse le coefficent de la normale pour le faire `rebondir'
            \begin{equation}
                \Rightarrow\vb*{v}^{'} = -(\vb*{v}\cdot\vb*{n})\vb*{n} + (\vb*{v}\cdot\vb*{t})\vb*{t}
            \end{equation}
            
            % TODO ca fait qqchose cheloue dans le rendu mais en socuprait de ca a la fin?
\section{Comment on a concue notre probleme}
    \begin{itemize}
        \item On a pris l'interaction des forces totale sur chaque particule par la fonction dans l'article `Cheerios effect'
        \item et de ca on deduis la force que reagis a chaque cheerios pour un pas de temps 
        \item Check si il ya des collisions ou pas et si il ya on change les proprietes des cheerios par rapport aux collisions
        \item De la force en utilisant l'integration de verlet et le principe fondamentale de la dynamique somme forces = derive (masse*vitesse) on peux changer les positions des cheerios
    \end{itemize}
    % Je panse pas que on a besoin de inclure ca car si on fait bien notre taff dans le rapport ils devrait le comprendre et dans le code le code cest comme si cetait ecris en psuedo code 
    % Psuedocode:
    % Prends les donnees 
    % Pour tout les pas de temps(NT)
    %     Parcour chaque objets et compare entre eux si il ya collision.
    %         Si oui 
    %             Applique collisions comme TODO si on va utiliser ca citer lequation dans le quel on en parle
    %         si non
    %             applique force 
    %     pour chaque objet applique force du bord
    %     pour chaque objet integration de verlet
    %     ecriture dans le fichier donnees 
    
\section{Les choses a ameliorer}
    \begin{itemize}
        \item Code en $O(NT\,n^2)$ et peux etre ameliorer enn$O(NT\, n\log n)$ en faisant le calcul de collisions plus inteligament a la place de une recherche exasthive et en calculant une seule fois le \textit{millieu} des forces de chaque particule pour avoir un centre de atraction et comme ca on calcule le centre de attraction regarde si on a des collisions ou pas et a la fin ajoute les forces du bords a chaque particule
        \item pour linstant on utilise les equations \textit{aproximatives} on peux les essayer de les resoudres sans approximations en utilisant laproximation de Nicholson(fine difference method)
        \item le code marche seulement pour les objets ronds faux ajouter une facon plus complexe pour plus de objets
    \end{itemize}
\section*{Conclusion}

\newpage
\thispagestyle{empty}
\nocite{*}
\addcontentsline{toc}{section}{Bibliographie}
\printbibliography[title = Bibliographie]

\end{document}